// Generated by CoffeeScript 1.6.3
var Player, sync;

sync = {
  'GDrive': {
    'key': '361504558285.apps.googleusercontent.com',
    "scope": "https://www.googleapis.com/auth/drive",
    "app_name": "tetris"
  }
};

Nimbus.Auth.setup(sync);

Player = Nimbus.Model.setup('Player', ['id', 'name', 'role', 'online', 'board', 'piece', 'restart']);

Nimbus.Auth.set_app_ready(function() {
  if (Nimbus.Auth.authorized()) {
    return Player.sync_all(function() {
      return console.log('players synced');
    });
  }
});

$(function() {
  var fill_player, set_player;
  set_player = function(player, data) {
    player.email = data.email;
    player.role = data.role;
    player.id = data.id;
    return player.name = data.name;
  };
  fill_player = function(user) {
    var players;
    console.log(user);
    user.online = true;
    players = Player.all();
    if (user.role === 'owner') {
      if (players[0]) {
        return set_player(players[0], user);
      }
    } else if (user.role === 'writer') {
      if (players[1]) {
        return set_player(players[1], user);
      }
    } else {
      return console.log('error' + JSON.stringify(user));
    }
  };
  $('#login').click = function() {
    return Nimbus.Auth.authorize('GDrive');
  };
  return $('#invite').click = function() {
    var email;
    email = $('invite_email').val();
    return Nimbus.Share.add_share_user_real(email, function(user) {
      return fill_player(user);
    });
  };
});
